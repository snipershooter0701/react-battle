# 用React与Redux-saga实现坦克大战

*TODO 坦克大战介绍*



游戏主要包括~~三个~~四个方面的内容: 素材 展现 数据 逻辑

## 素材

#### 内容

素材主要包括了以下各方面的内容:

1. 图片素材. 例如坦克的形状/颜色, 各种地形的颜色/样子等
2. 关卡配置. 每一关的战场地形配置, 一关内会出现的敌对坦克的数量和等级.
3. 数值配置. 例如子弹的速度, 坦克的移动速度, 道具铲子的持续时间等.
4. 游戏场景. 游戏开始/结束场景, 关卡结算场景等
5. 音效

#### 图片素材的获取与保存

图片素材可以从网上下载得到. 文件*resources/General Sprites.png*包含了坦克大战绝大部分的图片素材. 因为游戏使用SVG来展现画面, 所以需要的PNG文件中的素材进行矢量化处理. 大概的思路是将PNG中的每个像素点, 转换为SVG中1x1的小矩形. 这样可以使得整个游戏呈现像素风格. 素材也可以适当地转换为SVG矩形元素(rect)或是SVG路径元素(path).

大部分的素材, 都是通过手工输入的方式得到的. 例如坦克生成时的闪光效果(对应组件`<Flicker />`, 位于*app/components/Flicker.tsx*文件内), 其颜色为白色, 形状可认为是若干个矩形的叠加, 我们使用若干个SVG矩形元素就能表示闪光效果了. 

对于一些比较复杂的素材, 我们将其分解为若干个部分, 对每个部分进行矢量化, 然后组装起来得到整体素材. 例如, *app/components/tanks.tsx*中将坦克分解为若干部分:

```
左侧的轮胎(left-tire):
	轮胎的背景色
	轮胎上的花纹
右侧的轮胎(right-tire):
	轮胎的背景色
	轮胎上的花纹
坦克主体(tank-body):
	坦克主体的轮廓
	坦克主体上的装饰
坦克炮管(gun)
```

![素材分解](resource-decompose.jpg)

一些素材的形状具有一定的模式, 此时我们可以使用循环/分支的方式来生成所需要的SVG元素. 例如一个完整的砖墙的大小为16x16, 但是砖墙的左上/右上/左下/右下四个部分是完全一样的, 有了砖墙左上部分(8x8)的SVG之后, 使用循环可以生成整个砖墙.

一些素材的形状非常不规则, 难以通过手工的方式进行输入, 例如子弹/坦克的爆炸效果, 掉落的道具. 我们使用脚本读取原始素材中每个像素点的颜色值, 然后将其转换为一个字符, 用于保存该点的颜色值. React渲染时, 根据字符渲染出对应颜色的矩形(1x1). 该方式可以方便地对素材进行矢量化, 但是会导致React组件数量大大增加, 降低效率.

总之, 将图片素材矢量化较为灵活, 可以充分利用循环/分支/组合来简化矢量化过程. *app/components/elements.tsx*中的`<Pixel />`与`<BitMap />`组件在矢量化的过程中提供了很大的便利, 可供参考.

完成素材的矢量化之后, 放在stories页面进行查看, 和原始素材进行对比, 方便改正其中的错误.

#### 关卡配置的获取与保存

[坦克大战WIKI](https://strategywiki.org/wiki/Battle_City)上有完整的关卡配置表, 根据配置表使用关卡编辑器页面生成关卡配置JSON文件即可.

#### 其他素材的获取与保存

数值配置和音效还没有搞定.

游戏场景. 游戏开始/结束场景, 关卡结算场景等 TODO

## 展现

获取到所需的素材并封装成React组件之后, 游戏内容的展现其实变成了组件如何进行组合的问题了. *app/main.tsx*是整个应用的入口, 而*app/App.tsx*是展现的入口. 从*app/App.tsx*文件中可以看到, 根据当前游戏状态的不同, 游戏会展现对应的场景. 游戏标题画面对应`<GameTitleScene />`; 游戏主画面对应`<GameScene />`; 游戏结束画面对应`<GameoverScene />`; 而每一个关卡结束时的统计画面对应`<StatisticScene />`. 游戏画面中还包括了一些其他辅助元素: `<CurtainsContainer />` / `<PauseIndicator />` / `<Inspector />` / `<HelpInfo />`



TODO 其他的场景比较简单. 简单介绍一下`<GameScene />`



## TODO 数据

介绍redux store中的数据结构

## TODO 逻辑

介绍游戏使用了哪些saga; 不同的saga分别对应什么功能; 画出一棵"saga树"